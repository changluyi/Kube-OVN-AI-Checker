# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› Kube-OVN-LangGraph-Checker çš„æ¶æ„æ¦‚è§ˆï¼Œå¸®åŠ©æ‚¨ç†è§£ç³»ç»Ÿè®¾è®¡åŸç†ã€æ ¸å¿ƒç»„ä»¶å’ŒæŠ€æœ¯é€‰å‹ã€‚

## ğŸ“ ç³»ç»Ÿå®šä½

**Kube-OVN-LangGraph-Checker** æ˜¯ä¸€ä¸ªåŸºäº LLM Agent çš„æ™ºèƒ½ Kube-OVN ç½‘ç»œè¯Šæ–­å·¥å…·ï¼Œé€šè¿‡è‡ªä¸»å†³ç­–å’Œæ¸è¿›å¼æ¨ç†ï¼Œå°†è¿ç»´äººå‘˜ä»ç¹ççš„æ‰‹åŠ¨æ’æŸ¥ä¸­è§£æ”¾å‡ºæ¥ã€‚

### æ ¸å¿ƒä»·å€¼

| ä¼ ç»Ÿæ–¹æ³• | Kube-OVN Checker |
|---------|-----------------|
| æ‰‹åŠ¨æ‰§è¡Œ 20+ å‘½ä»¤ | AI è‡ªä¸»é€‰æ‹©å·¥å…· |
| éœ€è¦ä¸“å®¶ç»éªŒ | æ™ºèƒ½è¯Šæ–­ï¼Œé™ä½é—¨æ§› |
| è€—æ—¶ 30-60 åˆ†é’Ÿ | 5-10 åˆ†é’Ÿå®Œæˆ |
| æ˜“é—æ¼ç»†èŠ‚ | ç³»ç»ŸåŒ–æ£€æŸ¥ |
| ä¾èµ–ä¸ªäººè®°å¿† | çŸ¥è¯†åº“é©±åŠ¨ |

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. Agent è‡ªä¸»å†³ç­–

> **"LLM è‡ªä¸»å†³å®šä½¿ç”¨å“ªäº›å·¥å…·ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç å†³ç­–æ ‘"**

**ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜**:
```python
# ç¡¬ç¼–ç å†³ç­–æ ‘
if pod_restart:
    if ovs_error:
        check_ovs_log()
    else:
        check_kubelet_log()
else:
    check_network()
```

**ReAct Agent çš„ä¼˜åŠ¿**:
```python
# è‡ªä¸»å†³ç­–
Thought: Pod ä¸€ç›´åœ¨é‡å¯ï¼Œéœ€è¦æŸ¥çœ‹æ—¥å¿—
Action: collect_pod_logs("my-pod")

Observation: æ—¥å¿—æ˜¾ç¤º "Failed to create OVS port"

Thought: OVS ç«¯å£åˆ›å»ºå¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥ OVS çŠ¶æ€
Action: collect_ovs_vsctl()
```

**ä»·å€¼**:
- âœ… çµæ´»åº”å¯¹æœªçŸ¥é—®é¢˜
- âœ… ç»„åˆå¤šä¸ªå·¥å…·çš„èƒ½åŠ›
- âœ… æ¸è¿›å¼æ¨ç†æ”¶æ•›åˆ°æ ¹å› 

---

### 2. åˆ†å±‚è¯Šæ–­ç­–ç•¥

> **"ä»å¿«é€Ÿæ£€æŸ¥åˆ°æ·±åº¦åˆ†æï¼Œæ¸è¿›å¼æ”¶æ•›"**

```
T0 (10ç§’)     T1 (30ç§’)     T2 (æ·±åº¦)
   â†“             â†“              â†“
å¿«é€Ÿæ£€æŸ¥   â†’  è¯¦ç»†è¯Šæ–­   â†’  æ ¹å› åˆ†æ
å¥åº·æ‰«æ   â†’  è¯æ®æ”¶é›†   â†’  æ·±åº¦æ¨ç†
ç­›é€‰é—®é¢˜   â†’  éªŒè¯å‡è®¾   â†’  æ”¶æ•›ç»“è®º
```

**ä¼˜åŠ¿**:
- **å¿«é€Ÿåé¦ˆ** - T0 åœ¨ 10 ç§’å†…å®Œæˆ
- **æŒ‰éœ€æ·±å…¥** - åªå¯¹é—®é¢˜åŒºåŸŸè¯¦ç»†åˆ†æ
- **é¿å…ç›²ç›®** - ä¸"å¤§æµ·æé’ˆ"

---

### 3. è¯æ®é©±åŠ¨åˆ†æ

> **"ä¸çŒœæµ‹ä¸å‡è®¾ï¼Œæ¯ä¸ªç»“è®ºéƒ½æœ‰æ•°æ®æ”¯æ’‘"**

**è¯Šæ–­æµç¨‹**:
1. **T0 å‘ç°å¼‚å¸¸** - å¦‚ Pod é‡å¯
2. **å½¢æˆå‡è®¾** - å¯èƒ½æ˜¯ OVS é…ç½®é”™è¯¯
3. **æ”¶é›†è¯æ®** - ovn-trace, æ—¥å¿—ç­‰
4. **éªŒè¯å‡è®¾** - è¯æ®æ”¯æŒæˆ–æ¨ç¿»å‡è®¾
5. **æ”¶æ•›åˆ°æ ¹å› ** - é‡å¤ç›´åˆ°æ‰¾åˆ°æ ¹æœ¬åŸå› 

---

### 4. çŸ¥è¯†åº“å¢å¼º

> **"å°† Kube-OVN ä¸“å®¶çŸ¥è¯†æ³¨å…¥ LLM"**

**çŸ¥è¯†åº“å†…å®¹**:
- æ§åˆ¶å¹³é¢åŸç† (2 ä¸ªæ–‡æ¡£)
- æ•°æ®å¹³é¢åŸç† (10 ä¸ªæ–‡æ¡£)
- è¯Šæ–­å·¥ä½œæµ (3 ä¸ªæ–‡æ¡£)

**å¢å¼ºæ–¹å¼**:
- è§¦å‘è¯åŒ¹é…
- å…ƒæ•°æ®æ£€ç´¢
- LLM æ™ºèƒ½æ£€ç´¢

---

## ğŸ›ï¸ æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç”¨æˆ·å±‚ (CLI)                       â”‚
â”‚          Python 3.9+ / Rich ç»ˆç«¯               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Agent æ™ºèƒ½å±‚ (LangGraph)                â”‚
â”‚    LangChain 0.3.0+ / LangGraph 1.0.3+         â”‚
â”‚     ReAct æ¨¡å¼ / å·¥å…·è°ƒç”¨ / å¤šè½®æ¨ç†            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å·¥å…·å±‚ (26 ä¸ªè¯Šæ–­å·¥å…·)                   â”‚
â”‚      kubectl / kubectl-ko / OVN/OVS å‘½ä»¤        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®æ”¶é›†å±‚ (K8s API)                    â”‚
â”‚      Kubernetes Python Client                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      LLM æ¨ç†å±‚ (OpenAI / å…¼å®¹æœåŠ¡)             â”‚
â”‚   GPT-4o / DeepSeek / æ™ºè°± AI / Ollama         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¡†æ¶

| æ¡†æ¶ | ç‰ˆæœ¬ | ç”¨é€” |
|-----|------|------|
| **Python** | 3.9+ | ä¸»è¦å¼€å‘è¯­è¨€ |
| **LangGraph** | 1.0.3+ | Agent çŠ¶æ€æœº |
| **LangChain** | 0.3.0+ | LLM æŠ½è±¡å±‚ |
| **Pydantic** | 2.0+ | æ•°æ®éªŒè¯ |
| **asyncio** | - | å¼‚æ­¥å¹¶å‘ |
| **Rich** | 13.0+ | ç»ˆç«¯ç¾åŒ– |

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶

### 1. CLI å±‚

**æ–‡ä»¶**: `kube_ovn_checker/cli/main.py`

**èŒè´£**:
- è§£æå‘½ä»¤è¡Œå‚æ•°
- è·å–ç”¨æˆ·æŸ¥è¯¢
- åˆå§‹åŒ– Analyzer
- å±•ç¤ºè¯Šæ–­è¿›åº¦
- æ ¼å¼åŒ–è¾“å‡ºç»“æœ

**å…³é”®ä»£ç **:
```python
async def main():
    # 1. è·å–æŸ¥è¯¢
    query = get_user_query()

    # 2. åˆå§‹åŒ– Analyzer
    analyzer = LLMAgentAnalyzer(
        model=os.getenv("LLM_MODEL", "gpt-4o"),
        api_key=os.getenv("OPENAI_API_KEY")
    )

    # 3. æ‰§è¡Œè¯Šæ–­
    result = await analyzer.diagnose(
        query,
        progress_callback=print_progress
    )

    # 4. è¾“å‡ºç»“æœ
    print_diagnosis(result)
    save_report(result)
```

---

### 2. åˆ†ç±»å±‚

**æ–‡ä»¶**: `kube_ovn_checker/classifier.py`

**èŒè´£**:
- å°†ç”¨æˆ·æŸ¥è¯¢åˆ†ç±»åˆ° 5 ä¸ªåœºæ™¯
- è§¦å‘ç›¸å…³çŸ¥è¯†åº“æ³¨å…¥

**æ”¯æŒçš„åœºæ™¯**:
```python
class DiagnosisCategory(Enum):
    GENERAL = "general"                    # é€šç”¨æŸ¥è¯¢
    POD_TO_POD = "pod_to_pod"             # åŒèŠ‚ç‚¹ Pod é€šä¿¡
    POD_TO_POD_CROSS_NODE = "pod_to_pod_cross_node"  # è·¨èŠ‚ç‚¹ Pod é€šä¿¡
    POD_TO_SERVICE = "pod_to_service"     # Service è®¿é—®
    POD_TO_EXTERNAL = "pod_to_external"   # å¤–éƒ¨ç½‘ç»œè®¿é—®
```

**åˆ†ç±»å™¨å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·æŸ¥è¯¢
    â†“
LLM åˆ†ç±» (gpt-4o-mini)
    â†“
softmax æ¦‚ç‡è®¡ç®—
    â†“
ç½®ä¿¡åº¦ > 0.7?
    â†“ æ˜¯
è¿”å›åœºæ™¯åˆ†ç±»
    â†“ å¦
è¿”å› GENERAL (é»˜è®¤)
```

---

### 3. Agent å±‚

**æ–‡ä»¶**: `kube_ovn_checker/analyzers/llm_agent_analyzer.py`

**æ ¸å¿ƒç±»**: `LLMAgentAnalyzer`

**çŠ¶æ€æœº** (LangGraph):
```python
from langgraph.graph import StateGraph

class AgentState(TypedDict):
    query: str
    category: str
    t0_result: Dict
    collected_evidence: List[Dict]
    current_hypothesis: str
    rounds: int
    diagnosis: Optional[Diagnosis]

# å®šä¹‰çŠ¶æ€è½¬æ¢
workflow = StateGraph(AgentState)

workflow.add_node("t0_check", t0_check_node)
workflow.add_node("analyze", analyze_node)
workflow.add_node("collect", collect_node)
workflow.add_node("conclude", conclude_node)

workflow.add_edge("t0_check", "analyze")
workflow.add_conditional_edges(
    "analyze",
    should_collect_more,
    {
        "collect": "collect",
        "conclude": "conclude"
    }
)
workflow.add_edge("collect", "analyze")

workflow.set_entry_point("t0_check")
workflow.set_finish_point("conclude")
```

**ReAct å¾ªç¯**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ†æå½“å‰çŠ¶æ€                         â”‚
â”‚  - æŸ¥çœ‹ T0 ç»“æœ                      â”‚
â”‚  - æŸ¥çœ‹å·²æ”¶é›†è¯æ®                     â”‚
â”‚  - å½¢æˆæˆ–æ›´æ–°å‡è®¾                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨ç† (Thought)                       â”‚
â”‚  - éœ€è¦ä»€ä¹ˆä¿¡æ¯?                     â”‚
â”‚  - å“ªäº›å·¥å…·èƒ½æä¾›?                   â”‚
â”‚  - æ˜¯å¦å·²ç»æ”¶æ•›åˆ°æ ¹å› ?                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                   â†“
[éœ€è¦æ›´å¤šä¿¡æ¯]      [å·²æ”¶æ•›]
    â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡ŒåŠ¨ (Action)                        â”‚
â”‚  - é€‰æ‹©å·¥å…·                           â”‚
â”‚  - æ‰§è¡Œæ”¶é›†                           â”‚
â”‚  - æ›´æ–°è¯æ®                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    è¿”å›åˆ†æçŠ¶æ€
```

---

### 4. å·¥å…·å±‚

**æ–‡ä»¶**: `kube_ovn_checker/analyzers/tools/__init__.py`

**å·¥å…·åˆ†ç±»**:

#### Pod å·¥å…· (4 ä¸ª)
1. `collect_pod_logs` - æ”¶é›† Pod æ—¥å¿—
2. `collect_pod_events` - æ”¶é›† Pod äº‹ä»¶
3. `collect_pod_describe` - æ”¶é›† Pod è¯¦æƒ…
4. `collect_pod_ip` - è·å– Pod IP

#### Subnet å·¥å…· (1 ä¸ª)
5. `collect_subnet_status` - æ”¶é›† Subnet çŠ¶æ€

#### Node å·¥å…· (6 ä¸ª)
6. `collect_node_info` - èŠ‚ç‚¹åŸºæœ¬ä¿¡æ¯
7. `collect_node_ip_addr` - IP åœ°å€
8. `collect_node_ip_route` - è·¯ç”±è¡¨
9. `collect_node_iptables` - é˜²ç«å¢™è§„åˆ™
10. `collect_node_ipvs` - IPVS è§„åˆ™
11. `collect_node_sysctl` - å†…æ ¸å‚æ•°

#### Controller æ—¥å¿— (5 ä¸ª)
12. `collect_kube_ovn_controller_logs` - kube-ovn-controller æ—¥å¿—
13. `collect_kube_ovn_cni_logs` - kube-ovn-cni æ—¥å¿—
14. `collect_ovn_controller_logs` - ovn-controller æ—¥å¿—
15. `collect_ovn_northd_logs` - ovn-northd æ—¥å¿—
16. `collect_ovs_vswitchd_logs` - ovs-vswitchd æ—¥å¿—

#### OVN/OVS å·¥å…· (7 ä¸ª)
17. `collect_ovn_trace` - OVN å¾®æµè¿½è¸ª â­ **é¦–é€‰å·¥å…·**
18. `collect_ovn_nbctl` - OVN åŒ—å‘ DB
19. `collect_ovn_sbctl` - OVN å—å‘ DB
20. `collect_ovs_vsctl` - OVS äº¤æ¢æœºé…ç½®
21. `collect_ovs_ofctl` - OpenFlow æµè¡¨
22. `collect_ovs_dpctl` - OVS æ•°æ®è·¯å¾„
23. `collect_ovn_appctl` - OVS å®ˆæŠ¤è¿›ç¨‹æ§åˆ¶

#### ç½‘ç»œæŠ“åŒ… (2 ä¸ª)
24. `collect_tcpdump` - Pod æµé‡æŠ“åŒ…
25. `collect_node_tcpdump` - èŠ‚ç‚¹ç½‘å¡æŠ“åŒ…

#### T0 æ£€æŸ¥ (1 ä¸ª)
26. `collect_t0_check` - T0 å¿«é€Ÿå¥åº·æ£€æŸ¥

---

### 5. æ”¶é›†å±‚

**æ–‡ä»¶**: `kube_ovn_checker/collectors/resource_collector.py`

**æ ¸å¿ƒç±»**: `K8sResourceCollector`

**ç‰¹ç‚¹**:
- **å¼‚æ­¥å¹¶å‘**: ä½¿ç”¨ `asyncio.gather()`
- **ç¼“å­˜æœºåˆ¶**: é¿å…é‡å¤ API è°ƒç”¨
- **ç»Ÿä¸€æ ¼å¼**: æ‰€æœ‰å·¥å…·è¿”å›ç›¸åŒç»“æ„

**å¼‚æ­¥å¹¶å‘ç¤ºä¾‹**:
```python
async def collect_multiple_pods(
    pod_names: List[str],
    namespace: str
) -> List[Dict]:
    """å¹¶å‘æ”¶é›†å¤šä¸ª Pod çš„ä¿¡æ¯"""

    # åˆ›å»ºå¹¶å‘ä»»åŠ¡
    tasks = [
        collect_pod_logs(name, namespace)
        for name in pod_names
    ]

    # å¹¶å‘æ‰§è¡Œ
    results = await asyncio.gather(*tasks)

    return results
```

---

### 6. çŸ¥è¯†åº“å±‚

**æ–‡ä»¶**: `kube_ovn_checker/knowledge/`

**çŸ¥è¯†åº“ç»“æ„**:
```
knowledge/
â”œâ”€â”€ principles/              # æŠ€æœ¯åŸç† (12 ä¸ªæ–‡æ¡£)
â”‚   â”œâ”€â”€ control-plane/
â”‚   â”‚   â”œâ”€â”€ control-plane-architecture.md
â”‚   â”‚   â””â”€â”€ control-plane-reference.md
â”‚   â””â”€â”€ dataplane/
â”‚       â”œâ”€â”€ pod-communication/ (4 ä¸ª)
â”‚       â”œâ”€â”€ node-communication/ (3 ä¸ª)
â”‚       â””â”€â”€ service-communication/ (3 ä¸ª)
â”‚
â””â”€â”€ workflows/               # è¯Šæ–­å·¥ä½œæµ (3 ä¸ªæ–‡æ¡£)
    â”œâ”€â”€ network-connectivity.md
    â”œâ”€â”€ ip-management.md
    â””â”€â”€ general.md
```

**çŸ¥è¯†æ³¨å…¥æœºåˆ¶**:
```python
class KnowledgeInjector:
    async def inject_for_scenario(
        self,
        category: DiagnosisCategory,
        query: str
    ) -> str:
        """ä¸ºç‰¹å®šåœºæ™¯æ³¨å…¥ç›¸å…³çŸ¥è¯†"""

        # 1. å…ƒæ•°æ®å¿«é€ŸåŒ¹é…
        docs = self.retriever.retrieve_by_metadata(
            category=category,
            triggers=self._extract_triggers(query)
        )

        # 2. LLM æ™ºèƒ½æ£€ç´¢
        if not docs:
            docs = await self.llm_retriever.retrieve(query)

        # 3. é™åˆ¶é•¿åº¦
        content = self._limit_length(docs, max_tokens=2000)

        return content
```

---

## ğŸ“Š è¯Šæ–­æµç¨‹æ¦‚è§ˆ

```mermaid
graph TB
    A[ç”¨æˆ·æŸ¥è¯¢] --> B[æ™ºèƒ½åˆ†ç±»]
    B --> C{T0 å¿«é€Ÿæ£€æŸ¥}
    C --> D[Agent åˆ†æ]
    D --> E{éœ€è¦æ›´å¤šä¿¡æ¯?}
    E -->|æ˜¯| F[é€‰æ‹©å·¥å…·]
    F --> G[æ”¶é›†è¯æ®]
    G --> D
    E -->|å¦| H[ç”Ÿæˆç»“è®º]
    H --> I[è¾“å‡ºç»“æœ]
```

### è¯Šæ–­æµç¨‹è¯¦è§£

#### ç¬¬ 1 æ­¥: æ™ºèƒ½åˆ†ç±» (0.5 ç§’)
```
ç”¨æˆ·æŸ¥è¯¢: "Pod A æ— æ³•è®¿é—® Pod B"
    â†“
LLM åˆ†ç±»å™¨ (gpt-4o-mini)
    â†“
åœºæ™¯åˆ†ç±»: POD_TO_POD (ç½®ä¿¡åº¦ 0.92)
    â†“
æ³¨å…¥ç›¸å…³çŸ¥è¯†: Pod é€šä¿¡åŸç†
```

#### ç¬¬ 2 æ­¥: T0 å¿«é€Ÿæ£€æŸ¥ (10 ç§’)
```
å¹¶å‘æ‰§è¡Œ 20+ æ£€æŸ¥:
    - Deployments å¥åº·çŠ¶æ€
    - DaemonSets å¥åº·çŠ¶æ€
    - Endpoints å¯ç”¨æ€§
    - Controller çŠ¶æ€
    - Pod ç»Ÿè®¡ä¿¡æ¯
    - Subnet æ¦‚è§ˆ
    â†“
ç”Ÿæˆ T0 æŠ¥å‘Š
```

#### ç¬¬ 3 æ­¥: Agent å¤šè½®æ¨ç† (æ¯è½® 5-15 ç§’)
```
Round 1: åˆ†æ T0 ç»“æœ
    Thought: æ‰€æœ‰ç»„ä»¶å¥åº·ï¼Œå¯èƒ½æ˜¯é…ç½®é—®é¢˜
    Action: collect_ovn_trace(src=PodA, dst=PodB)
    Observation: æµé‡è¢« ACL æ‹’ç»

Round 2: éªŒè¯å‡è®¾
    Thought: ACL æ‹’ç»ï¼Œéœ€è¦æŸ¥çœ‹ NetworkPolicy
    Action: collect_network_policies()
    Observation: å­˜åœ¨ deny-all ç­–ç•¥

Round 3: æ”¶æ•›ç»“è®º
    Thought: ç¡®è®¤æ˜¯ NetworkPolicy å¯¼è‡´
    Conclusion: ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
```

#### ç¬¬ 4 æ­¥: ç”Ÿæˆç»“æœ
```json
{
  "issue": "Pod A æ— æ³•è®¿é—® Pod B",
  "root_cause": "NetworkPolicy 'deny-all' é˜»æ­¢æµé‡",
  "severity": "high",
  "solutions": [
    {
      "priority": 1,
      "description": "åˆ›å»ºå…è®¸æµé‡çš„ NetworkPolicy",
      "commands": ["kubectl apply -f ..."]
    }
  ],
  "evidence": {
    "ovn_trace": "...",
    "network_policies": ["deny-all"]
  },
  "diagnosis_status": "completed",
  "rounds": 3
}
```

---

## ğŸ¯ è´¨é‡å±æ€§

| å±æ€§ | ç›®æ ‡ | å®ç°ç­–ç•¥ |
|-----|------|---------|
| **è¯Šæ–­é€Ÿåº¦** | < 2 åˆ†é’Ÿ | T0 å¿«é€Ÿæ£€æŸ¥ã€å¹¶å‘æ”¶é›† |
| **å‡†ç¡®ç‡** | > 85% | çŸ¥è¯†åº“å¢å¼ºã€å¤šè½®æ¨ç† |
| **å¯ç”¨æ€§** | 99.9% | é™çº§æœºåˆ¶ã€è§„åˆ™å…œåº• |
| **å¯æ‰©å±•æ€§** | 1000+ èŠ‚ç‚¹ | ç¼“å­˜æœºåˆ¶ã€åˆ†é¡µæ”¶é›† |
| **å®‰å…¨æ€§** | åªè¯»æ“ä½œ | RBAC æƒé™é™åˆ¶ |

---

## ğŸ”’ å®‰å…¨è¾¹ç•Œ

### åªè¯»ä¿è¯

å·¥å…·éµå¾ª **åªè¯»åŸåˆ™**ï¼Œä¸ä¼šä¿®æ”¹é›†ç¾¤çŠ¶æ€ï¼š

âœ… **å…è®¸çš„æ“ä½œ**:
- `kubectl get` - æŸ¥çœ‹èµ„æº
- `kubectl logs` - æŸ¥çœ‹æ—¥å¿—
- `kubectl describe` - æŸ¥çœ‹è¯¦æƒ…
- `kubectl exec` - æ‰§è¡Œåªè¯»å‘½ä»¤

âŒ **ä¸å…è®¸çš„æ“ä½œ**:
- `kubectl delete` - åˆ é™¤èµ„æº
- `kubectl apply` - ä¿®æ”¹é…ç½®
- `kubectl edit` - ç¼–è¾‘èµ„æº
- ä»»ä½•å†™å…¥æ“ä½œ

### æ•°æ®éšç§

**å‘é€ç»™ LLM çš„æ•°æ®**:
- T0 æ£€æŸ¥ç»“æœï¼ˆæ±‡æ€»ä¿¡æ¯ï¼‰
- å·¥å…·æ”¶é›†çš„æ—¥å¿—å’Œé…ç½®
- Pod åç§°ã€å‘½åç©ºé—´
- è¯Šæ–­é—®é¢˜æè¿°

**ä¸ä¼šå‘é€**:
- æ•æ„Ÿé…ç½®ï¼ˆSecretã€ConfigMap å†…å®¹ï¼‰
- ç”¨æˆ·å¯†ç å’Œå¯†é’¥
- ç§æœ‰è¯ä¹¦

**éšç§å»ºè®®**:
- å®¡æŸ¥è¯Šæ–­æŠ¥å‘Šåå†åˆ†äº«
- ä½¿ç”¨æœ¬åœ° LLM (Ollama) å¤„ç†æ•æ„Ÿæ•°æ®
- åœ¨ .env ä¸­é…ç½®è„±æ•è§„åˆ™

---

## ğŸ†š ä¸å…¶ä»–å·¥å…·å¯¹æ¯”

| å·¥å…· | ç±»å‹ | ä¼˜åŠ¿ | å±€é™ |
|-----|------|------|------|
| **Kube-OVN Checker** | LLM Agent | æ™ºèƒ½å†³ç­–ã€è‡ªé€‚åº” | ä¾èµ– LLM |
| **kubectl-kubeovn** | CLI | ç²¾ç¡®æ§åˆ¶ | éœ€è¦ä¸“å®¶ç»éªŒ |
| **Kubernetes Event** | ç›‘æ§ | è¢«åŠ¨æ”¶é›† | ä¸æä¾›æ ¹å›  |
| **Prometheus** | æŒ‡æ ‡ | è¶‹åŠ¿åˆ†æ | æ— ä¸Šä¸‹æ–‡ |

---

## ğŸ“ˆ æ€§èƒ½ç‰¹å¾

### æ—¶é—´åˆ†è§£

| é˜¶æ®µ | è€—æ—¶ | è¯´æ˜ |
|-----|------|------|
| æŸ¥è¯¢åˆ†ç±» | 0.5s | LLM åˆ†ç±» (gpt-4o-mini) |
| T0 æ£€æŸ¥ | 10s | å¹¶å‘æ‰§è¡Œ 20+ æ£€æŸ¥ |
| Agent æ¯è½® | 5-15s | LLM æ¨ç† + å·¥å…·æ‰§è¡Œ |
| **æ€»è®¡ (3 è½®)** | **30-60s** | å¤§éƒ¨åˆ†é—®é¢˜åœ¨ 3 è½®å†…è§£å†³ |

### å¹¶å‘æ€§èƒ½

```python
# T0 æ£€æŸ¥å¹¶å‘æ‰§è¡Œ
import asyncio

async def t0_check():
    # 20+ æ£€æŸ¥å¹¶å‘æ‰§è¡Œ
    tasks = [
        check_deployments(),      # 2s
        check_daemonsets(),       # 2s
        check_endpoints(),        # 1s
        check_pod_stats(),        # 3s
        check_subnet_status(),    # 2s
        ...
    ]

    # æ€»è€—æ—¶ = max(å„ä»»åŠ¡) â‰ˆ 10s
    # è€Œé sum(å„ä»»åŠ¡) â‰ˆ 50s
    results = await asyncio.gather(*tasks)
```

### ç¼“å­˜æ•ˆæœ

| æ•°æ®ç±»å‹ | ç¼“å­˜æ—¶é—´ | å‘½ä¸­ç‡ | æ€§èƒ½æå‡ |
|---------|---------|--------|---------|
| Pod åˆ—è¡¨ | 30s | 80% | 10x |
| Subnet çŠ¶æ€ | 60s | 90% | 5x |
| Node ä¿¡æ¯ | 120s | 95% | 3x |

---

## ğŸ“ æ¶æ„äº®ç‚¹

### 1. ReAct Agent æ¨¡å¼

**ä¼ ç»Ÿæ–¹æ³•**:
```python
if pod_restart:
    if ovs_error:
        check_ovs_log()
    else:
        check_kubelet_log()
else:
    check_network()
```

**ReAct Agent**:
```python
Thought: Pod ä¸€ç›´åœ¨é‡å¯ï¼Œéœ€è¦æŸ¥çœ‹æ—¥å¿—
Action: collect_pod_logs("my-pod")
Observation: æ—¥å¿—æ˜¾ç¤º "Failed to create OVS port"
Thought: OVS ç«¯å£åˆ›å»ºå¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥ OVS çŠ¶æ€
Action: collect_ovs_vsctl()
```

### 2. æ¸è¿›å¼è¯Šæ–­

```
Round 1: T0 â†’ å‘ç° Controller Pod é‡å¯
Round 2: æŸ¥çœ‹ Controller æ—¥å¿—
Round 3: OVN NB è¿æ¥å¤±è´¥
Round 4: ç¡®è®¤æ ¹å› : ovn-nb æœåŠ¡ä¸å¯è¾¾
```

### 3. å·¥å…·ä¼˜å…ˆçº§ç³»ç»Ÿ

| ä¼˜å…ˆçº§ | å·¥å…·ç±»å‹ | ç¤ºä¾‹ | åŸå›  |
|-------|---------|------|------|
| **P0 é¦–é€‰** | é€»è¾‘è·¯å¾„åˆ†æ | `ovn-trace` | å‡†ç¡®ã€å¿«é€Ÿ |
| **P1** | é…ç½®æ£€æŸ¥ | `ovn-nbctl` | æ— ä¾µå…¥ |
| **P2** | æ—¥å¿—åˆ†æ | `collect_logs` | è¯¦ç»†ä½†æ…¢ |
| **P3** | æµé‡æŠ“åŒ… | `tcpdump` | æœ€åæ‰‹æ®µ |

---

## ğŸ”® æœªæ¥å±•æœ›

### çŸ­æœŸè®¡åˆ’ (3 ä¸ªæœˆ)
- [ ] æ”¯æŒæ›´å¤š LLM æä¾›å•†
- [ ] æ·»åŠ æ›´å¤šè¯Šæ–­å·¥å…·
- [ ] ä¼˜åŒ–çŸ¥è¯†åº“æ£€ç´¢

### ä¸­æœŸè®¡åˆ’ (6 ä¸ªæœˆ)
- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆè‹±æ–‡ï¼‰
- [ ] Web UI ç•Œé¢
- [ ] API æ¥å£

### é•¿æœŸæ„¿æ™¯ (1 å¹´)
- [ ] è‡ªåŠ¨ä¿®å¤å»ºè®®æ‰§è¡Œ
- [ ] é›†æˆåˆ°ç›‘æ§å‘Šè­¦ç³»ç»Ÿ
- [ ] é¢„æµ‹æ€§åˆ†æ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ„å»ºå—è§†å›¾](building-blocks.md) - è¯¦ç»†çš„æ¨¡å—èŒè´£
- [è¿è¡Œæ—¶è§†å›¾](runtime-view.md) - è¯Šæ–­æµç¨‹è¯¦è§£
- [è¯Šæ–­æµç¨‹è¯¦è§£](diagnostic-workflow.md) - T0/T1/T2 åˆ†å±‚
- [å·¥å…·ç³»ç»Ÿ](tool-system.md) - 26 ä¸ªå·¥å…·è¯¦è§£

---

**ä¸‹ä¸€æ­¥**: [æ„å»ºå—è§†å›¾](building-blocks.md) | [è¿è¡Œæ—¶è§†å›¾](runtime-view.md)
